/* -----------------------------------------------------------------------------
 * 页面加载优化 - 解决加载时只显示背景和导航栏的问题
 * -----------------------------------------------------------------------------
 */

/* 页面元素的渐入动画 - 排除page-banner，避免干扰原始滚动效果 */
.main, .page-content, .site-header {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}

.main.loaded, .page-content.loaded, .site-header.loaded {
  opacity: 1;
  transform: translateY(0);
}

/* 确保page-banner不受我们的加载动画影响，保持原始模板的滚动效果 */
.page-banner {
  opacity: 1 !important;
  transform: none !important;
  /* 确保不覆盖原始的transition效果 */
  transition: all 0.3s ease !important;
}

/* 确保翻译菜单和语言选择器始终在最上层 */
.lang-select, 
.lang-select-container,
[data-lang],
li a[data-lang],
.site-nav ul li a img {
  z-index: 10000 !important; /* 确保比loading层的z-index(9999)高 */
  position: relative;
}

/* 页面加载动画 */
.page-loading {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: var(--kawaii-main-bg);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 1;
  transition: opacity 0.5s ease;
  pointer-events: none; /* 防止阻止页面交互 */
}

.page-loading.loaded {
  opacity: 0;
  pointer-events: none;
  visibility: hidden; /* 确保完全隐藏 */
}

/* 加载动画容器 */
.loading-animation {
  text-align: center;
  color: var(--kawaii-header-footer-bg);
}

/* Q弹胶囊动画 */
.loading-capsules {
  display: flex;
  gap: 14px;
  justify-content: center;
  align-items: center;
  height: 70px;
  margin-bottom: 20px;
  transform: translateZ(0); /* 启用硬件加速 */
}

.loading-capsule {
  width: 16px;
  height: 36px;
  background-color: var(--kawaii-header-footer-bg);
  border-radius: 8px;
  animation: capsule-bounce 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
  transform-origin: center center;
  will-change: transform;
}

/* 给每个胶囊添加延迟，形成轮流Q弹效果 */
.loading-capsule:nth-child(1) {
  animation-delay: 0s;
}

.loading-capsule:nth-child(2) {
  animation-delay: 0.3s;
}

.loading-capsule:nth-child(3) {
  animation-delay: 0.6s;
}

/* Q弹动画关键帧 - 更快更灵动的果冻效果 */
@keyframes capsule-bounce {
  0%, 80%, 100% {
    transform: scaleX(1) scaleY(1);
    opacity: 0.7;
  }
  8% {
    transform: scaleX(1.1) scaleY(0.9);
    opacity: 0.85;
  }
  16% {
    transform: scaleX(1.3) scaleY(1.6);
    opacity: 1;
  }
  24% {
    transform: scaleX(1.15) scaleY(1.3);
    opacity: 0.95;
  }
  32% {
    transform: scaleX(1.05) scaleY(1.1);
    opacity: 0.85;
  }
  40% {
    transform: scaleX(1) scaleY(1);
    opacity: 0.8;
  }
}

/* 加载文字样式 */
.loading-text {
  font-size: 16px;
  font-weight: 600;
  color: var(--kawaii-header-footer-bg);
  letter-spacing: 2px;
  animation: text-fade 1.2s ease-in-out infinite;
  transform: translateZ(0); /* 启用硬件加速 */
  /* 圆润字体设置 */
  font-family: 'Noto Sans', 'Microsoft YaHei', '微软雅黑', 'PingFang SC', 'Hiragino Sans GB', 'Source Han Sans CN', 'WenQuanYi Micro Hei', sans-serif;
  font-variation-settings: 'wght' 600; /* 可变字体粗细 */
  text-rendering: optimizeLegibility; /* 优化文字渲染 */
  -webkit-font-smoothing: antialiased; /* 平滑字体 */
  -moz-osx-font-smoothing: grayscale; /* macOS字体平滑 */
  /* 添加微妙的文字阴影增强圆润感 */
  text-shadow: 0 0 1px rgba(0, 0, 0, 0.1);
}

/* 文字渐隐动画 - 更柔和的效果 */
@keyframes text-fade {
  0%, 100% {
    opacity: 0.7;
    transform: translateY(0px);
  }
  50% {
    opacity: 1;
    transform: translateY(-1px);
  }
}

/* 响应式优化 */
@media (max-width: 768px) {
  .loading-capsules {
    height: 60px;
    gap: 10px;
  }
  
  .loading-capsule {
    width: 14px;
    height: 32px;
    border-radius: 7px;
  }
  
  .loading-text {
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 1.5px;
    font-family: 'Noto Sans', 'Microsoft YaHei', '微软雅黑', 'PingFang SC', 'Hiragino Sans GB', 'Source Han Sans CN', 'WenQuanYi Micro Hei', sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

@media (max-width: 480px) {
  .loading-capsules {
    height: 50px;
    gap: 8px;
  }
  
  .loading-capsule {
    width: 12px;
    height: 28px;
    border-radius: 6px;
  }
  
  .loading-text {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 1.2px;
    font-family: 'Noto Sans', 'Microsoft YaHei', '微软雅黑', 'PingFang SC', 'Hiragino Sans GB', 'Source Han Sans CN', 'WenQuanYi Micro Hei', sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/* 深色模式适配 */
html[data-theme="dark"] .page-loading {
  background-color: var(--kawaii-main-bg); /* 移除渐变，使用纯色背景 */
}

html[data-theme="dark"] .loading-capsule {
  background-color: var(--kawaii-header-footer-bg);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.25);
}

html[data-theme="dark"] .loading-text {
  color: var(--kawaii-primary);
  font-family: 'Noto Sans', 'Microsoft YaHei', '微软雅黑', 'PingFang SC', 'Hiragino Sans GB', 'Source Han Sans CN', 'WenQuanYi Micro Hei', sans-serif;
  font-weight: 600;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-shadow: 0 0 1px rgba(255, 255, 255, 0.1);
}



/* 文章项目的波浪式渐入 */
.post-item {
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}

.post-item.loaded {
  opacity: 1;
  transform: translateY(0);
}

/* 用户偏好设置 - 减少动画 */
@media (prefers-reduced-motion: reduce) {
  .loading-capsule,
  .loading-text {
    animation: none !important;
  }
  
  .main, .page-content, .site-header, .post-item {
    transition: none !important;
    opacity: 1 !important;
    transform: none !important;
  }
  
  /* 保持page-banner的原始动画，即使在减少动画模式下 */
}

/* -----------------------------------------------------------------------------
 * 二次元小清新风格 - 纯配色版本
 * 只更改配色，保持原有样式结构
 * -----------------------------------------------------------------------------
 */

/* 默认浅色主题 - 确保页面加载时使用浅色主题，避免闪烁 */
html:not([data-theme="dark"]) {
  --kawaii-primary: #03045e;
  --kawaii-secondary: #0077b6;
  --kawaii-accent: #90e0ef;
  --kawaii-dark: #03045e;
  --kawaii-nav-text: #ffffff;
  --kawaii-bg-primary: #74c69d;
  --kawaii-bg-secondary: #95d5b2;
  --kawaii-bg-light: #d8f3dc;
  --kawaii-main-bg: #cce3de;
  --kawaii-header-footer-bg: #6B9080;
  --kawaii-pink: #f8bbd9;
}

/* CSS变量定义 - 绿色背景 + 蓝色文字 */
:root {
  --kawaii-primary: #03045e;        /* 深蓝色 - 主要文字颜色 (原 #0077b6) */
  --kawaii-secondary: #0077b6;      /* 蓝色 - 辅助文字/链接 (原 #00b4d8) */
  --kawaii-accent: #90e0ef;         /* 淡蓝色 - 强调色 */
  --kawaii-dark: #03045e;           /* 深蓝色 - 深色文字 */
  --kawaii-nav-text: #ffffff;        /* 白色 - 导航栏文字 (新增) */
  --kawaii-bg-primary: #74c69d;     /* 绿色 - 主要背景色 */
  --kawaii-bg-secondary: #95d5b2;   /* 淡绿色 - 辅助背景 */
  --kawaii-bg-light: #d8f3dc;       /* 最淡绿色 - 浅色背景 */
  --kawaii-main-bg: #cce3de;        /* 主体背景色 - 很淡的薄荷绿 */
  --kawaii-header-footer-bg: #6B9080; /* 导航与页脚背景色 */
  --kawaii-pink: #f8bbd9;           /* 保留柔和粉色作为点缀 */
}

/* 深色模式适配 - 仅在手动设置为深色且系统偏好为深色时生效，避免初始闪烁 */
@media (prefers-color-scheme: dark) {
  html[data-theme="dark"] {
    --kawaii-primary: #90e0ef;      /* 深色模式下的淡蓝色文字 */
    --kawaii-secondary: #00b4d8;    /* 深色模式下的蓝色 */
    --kawaii-accent: #0077b6;       /* 深色模式下的深蓝色 */
    --kawaii-dark: #caf0f8;         /* 深色模式下的浅色文字 */
    --kawaii-bg-primary: #2d6a4f;   /* 深色模式下的深绿背景 */
    --kawaii-bg-secondary: #40916c; /* 深色模式下的绿色背景 */
    --kawaii-bg-light: #1b4332;     /* 深色模式下的深色背景 */
    --kawaii-main-bg: #1a1a1a;      /* 深色模式下的主体背景 - 标准深色 */
    --kawaii-header-footer-bg: #086375; /* 深色模式下的导航与页脚背景 */
    --kawaii-pink: #ce93d8;         /* 深色模式下的粉色 */
  }
}

/* 手动深色模式支持 - 优先级最高 */
html[data-theme="dark"] {
  --kawaii-primary: #90e0ef;
  --kawaii-secondary: #00b4d8;
  --kawaii-accent: #0077b6;
  --kawaii-dark: #caf0f8;
  --kawaii-nav-text: #ffffff;
  --kawaii-bg-primary: #2d6a4f;
  --kawaii-bg-secondary: #40916c;
  --kawaii-bg-light: #1b4332;
  --kawaii-main-bg: #1a1a1a;      /* 深色模式下的主体背景 - 标准深色 */
  --kawaii-header-footer-bg: #086375; /* 深色模式下的导航与页脚背景 */
  --kawaii-pink: #ce93d8;
}

/* 手动浅色模式支持 (用于覆盖OS深色模式) - 优先级最高 */
html[data-theme="light"] {
  --kawaii-primary: #03045e;
  --kawaii-secondary: #0077b6;
  --kawaii-accent: #90e0ef;
  --kawaii-dark: #03045e;
  --kawaii-nav-text: #ffffff;
  --kawaii-bg-primary: #74c69d;
  --kawaii-bg-secondary: #95d5b2;
  --kawaii-bg-light: #d8f3dc;
  --kawaii-main-bg: #cce3de;
  --kawaii-header-footer-bg: #6B9080; /* 导航与页脚背景色 */
  --kawaii-pink: #f8bbd9;
}


/* 主要配色调整 */

/* 主体背景颜色 - 使用CSS变量 */
body {
  background-color: var(--kawaii-main-bg) !important;
  color: var(--kawaii-primary) !important; /* 设置默认正文颜色 */
}

/* 确保主要内容区域背景透明，以显示body背景 */
.page-content {
  background-color: transparent !important;
}

/* 确保包装器也使用正确的背景色 */
.wrapper {
  background-color: transparent !important;
}

/* 确保主体区域使用正确的背景色 */
.main, section.main {
  background-color: transparent !important;
}

/* 页面横幅背景 */
.page-banner {
  background-color: transparent !important;
}

/* 确保文章列表区域背景正确 */
.articles, .post-list {
  background-color: transparent !important;
}

/* 强制覆盖可能的深色模式背景 */
html {
  background-color: var(--kawaii-main-bg) !important;
}

/* 网站标题颜色 - 在导航栏中，使用导航栏字体颜色 */
.site-title, .site-title a {
  color: var(--kawaii-nav-text) !important;
}

/* 标题颜色 */
h1, h2, h3, h4, h5, h6 {
  color: var(--kawaii-primary) !important;
}

/* 链接颜色 */
a {
  color: var(--kawaii-secondary) !important;
}

a:hover {
  color: var(--kawaii-primary) !important;
}

/* 按钮颜色 */
.btn-primary, .btn {
  background-color: var(--kawaii-bg-primary) !important;
  border-color: var(--kawaii-bg-primary) !important;
  color: white !important;
}

.btn-primary:hover, .btn:hover {
  background-color: var(--kawaii-bg-secondary) !important;
  border-color: var(--kawaii-bg-secondary) !important;
}

/* 导航链接颜色 */
.site-nav .page-link {
  color: var(--kawaii-nav-text) !important;
}

/* 导航链接激活状态 */
.site-nav .page-link:hover,
.site-nav .page-link.active {
  color: var(--kawaii-accent) !important; /* 激活时使用淡蓝色 */
}

/* 标签颜色 */
.tag, .badge {
  background-color: var(--kawaii-pink) !important;
  color: var(--kawaii-primary) !important;
}

/* 分页按钮 */
.pagination .page-link {
  color: var(--kawaii-secondary) !important;
}

.pagination .page-item.active .page-link {
  background-color: var(--kawaii-bg-primary) !important;
  border-color: var(--kawaii-bg-primary) !important;
}

/* 代码高亮主题色调整 */
.highlight {
  border-left: 4px solid var(--kawaii-primary) !important;
}

/* 引用块颜色 */
blockquote {
  border-left: 4px solid var(--kawaii-primary) !important;
  color: var(--kawaii-primary) !important;
}

/* 表格头部颜色 */
table th {
  background-color: var(--kawaii-bg-primary) !important;
  color: white !important;
}

/* 滚动条颜色 */
::-webkit-scrollbar-thumb {
  background-color: var(--kawaii-bg-primary) !important;
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--kawaii-bg-secondary) !important;
}

/* 选择文本颜色 */
::selection {
  background-color: var(--kawaii-pink) !important;
  color: var(--kawaii-primary) !important;
}

/* 主题切换按钮样式 - 透明背景版 */
.theme-toggle .btn {
  background-color: transparent !important;
  color: var(--kawaii-nav-text) !important; /* 按钮文字颜色与导航栏一致 */
  border: 1px solid var(--kawaii-nav-text) !important; /* 按钮边框颜色与导航栏一致 */
  box-shadow: none !important;
  transition: background-color 0.3s ease, color 0.3s ease;
  padding: 0.25rem 0.75rem !important;
  font-size: 0.9em !important;
  border-radius: 5px !important;
  line-height: 1.5 !important;
}

.theme-toggle .btn:hover {
  background-color: rgba(255, 255, 255, 0.2) !important; /* 悬停时半透明白色背景 */
  color: var(--kawaii-nav-text) !important;
  border-color: var(--kawaii-nav-text) !important;
}

/* 激活状态的按钮，表示当前主题 */
.theme-toggle .btn.active {
  background-color: var(--kawaii-nav-text) !important; /* 激活时背景为白色 */
  color: var(--kawaii-header-footer-bg) !important; /* 激活时文字为导航栏背景色 */
  border-color: var(--kawaii-nav-text) !important;
}

/* 按钮组容器，确保按钮紧凑排列 */
.theme-toggle .btn-group {
  gap: 5px; /* 按钮之间的间隙 */
}

/* 导航栏背景颜色 - 只在非透明状态设置 */
.site-header:not(.site-header-transparent) {
  background-color: var(--kawaii-header-footer-bg) !important;
  border-bottom: 1px solid var(--kawaii-bg-secondary) !important;
}

/* 导航栏滚动时的背景 */
.site-header.scrolled, 
.site-header:not(.transparent) {
  background-color: var(--kawaii-header-footer-bg) !important;
}

/* 修复导航栏收起时的线条问题和视觉跳跃 - 精确定位问题 */
html[data-scroll-status="top"] header.site-header-transparent {
  background-color: transparent !important; /* 保持透明背景 */
  box-shadow: none !important; /* 移除阴影线条 */
  border-bottom: none !important; /* 移除边框 */
  margin-top: 0 !important; /* 消除原主题的12px上边距，这是空缺的根源 */
  transition: background-color 0.05s ease, margin-top 0.1s ease !important; /* 快速透明过渡，保持原有高度动画 */
}

/* 页脚背景颜色 */
.site-footer {
  background-color: var(--kawaii-header-footer-bg) !important;
  border-top: 1px solid var(--kawaii-bg-secondary) !important;
  color: var(--kawaii-nav-text) !important;
}

/* 保持主内容区域为默认浅色背景，便于阅读 */

/* 卡片和容器背景 - 使用淡绿色边框 */
.post-list-item, .post-card, .card {
  border: 1px solid var(--kawaii-bg-secondary) !important;
}

/* 深浅色模式切换按钮区域 - 透明化 */
.theme-toggle, .theme-toggle-wrapper {
  background-color: transparent !important;
  border: none !important; /* 移除边框 */
}

/* 
  Correctly hide the 'NEW' pseudo-element on visited links by targeting the ::after pseudo-element.
  This rule applies to the main post list, related posts, and segment pages (like categories/tags).
*/
.pagination .post-title a:visited::after,
.post .post-related ul a:visited::after,
.page-segments li a:visited::after {
  background-color: var(--kawaii-main-bg) !important; /* Match the page background */
  color: var(--kawaii-main-bg) !important; /* Hide the text as well */
}

/* --- Banner标题美化 (最终修正版) --- */
/* 
  为页面/文章的Banner标题增加文本阴影，确保在各种背景(视频/深色/浅色图片)下的可读性。
  基于实际HTML结构: .page-banner-inner > .page-banner-default > h1/h2
*/
.page-banner .page-banner-inner {
  text-shadow: none !important; /* 强制移除主题默认的阴影 */
}

/* 使用正确的HTML结构路径 */
.page-banner .page-banner-inner .page-banner-default .page-banner-heading,
.page-banner .page-banner-inner .page-banner-default .page-banner-subheading {
  color: #fff !important; /* 固定为白色，增强对比 */
  text-shadow: 
    0 1px 3px rgba(0, 0, 0, 0.8),
    0 2px 6px rgba(0, 0, 0, 0.6),
    0 3px 9px rgba(0, 0, 0, 0.4) !important; /* 多层阴影，适应各种背景 */
}

/* 为子标题单独增加更强的阴影效果 */
.page-banner .page-banner-inner .page-banner-default .page-banner-subheading {
  text-shadow: 
    0 1px 2px rgba(0, 0, 0, 0.9),
    0 2px 4px rgba(0, 0, 0, 0.8),
    0 3px 6px rgba(0, 0, 0, 0.7),
    0 4px 8px rgba(0, 0, 0, 0.5) !important; /* 子标题专用：更多层更浓重的阴影 */
}

/* --- 分隔线样式修复 --- */
/* 
  修复浅色模式下分隔线不明显的问题
  原主题使用 #ebebeb，在浅色背景下几乎看不见
  使用更高特异性的选择器和硬编码颜色确保覆盖主题样式
*/
article.post .post-content hr,
.post article .post-content hr,
.post .post-content hr {
  height: 2px !important; /* 增加高度 */
  background-color: var(--kawaii-dark) !important; /* 使用淡绿色 - 硬编码确保生效 */
  border: none !important;
  margin: 40px 0 !important; /* 增加上下间距 */
  border-radius: 1px !important; /* 添加轻微圆角 */
  opacity: 1 !important; /* 确保不透明 */
}

/* --- 文章列表封面图片支持 --- */
.post-list .post-item {
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--kawaii-bg-secondary);
}

.post-list .post-item:last-child {
  border-bottom: none;
}

.post-excerpt {
  display: flex;
  gap: 1.5rem;
  margin: 1rem 0;
  align-items: flex-start;
}

/* 默认布局：图片在右边 */
.post-excerpt {
  flex-direction: row;
}

/* 图片在左边的布局 */
.post-excerpt.image-left {
  flex-direction: row;
}

/* 图片在右边的布局 */
.post-excerpt.image-right {
  flex-direction: row-reverse;
}

.post-image {
  flex: 0 0 240px; /* 增大图片区域 */
  text-decoration: none !important;
}

.post-image-container {
  width: 240px; /* 增大图片宽度 */
  height: 160px; /* 增大图片高度，更接近模板效果 */
  border-radius: 8px;
  border: 1px solid var(--kawaii-bg-secondary);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  overflow: hidden;
  position: relative;
}

.post-image-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
  display: block;
  transition: transform 0.3s ease;
}

.post-image:hover .post-image-container {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.post-image:hover .post-image-img {
  transform: scale(1.05);
}

.post-text {
  flex: 1;
  text-decoration: none !important;
  display: flex;
  flex-direction: column;
  gap: 0.5em;
  min-width: 0; /* 确保文字区域可以收缩 */
}

.post-excerpt-text {
  margin: 0;
  color: var(--kawaii-primary) !important;
  line-height: 1.6;
  font-size: 15px; /* 稍微增大字体 */
  max-height: 128px; /* 调整为5行的高度，匹配更大的图片 */
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 5; /* 限制为5行 */
  line-clamp: 5; /* 标准属性 */
  -webkit-box-orient: vertical;
}

.read_more {
  color: var(--kawaii-secondary) !important;
  font-weight: 500;
  font-size: 14px;
  align-self: flex-end; /* 右对齐 */
  margin-top: auto; /* 推到底部 */
}

/* 当图片在右边时，Read More 按钮左对齐 */
.post-excerpt.image-right .read_more {
  align-self: flex-start;
}

/* 响应式设计 */
@media (max-width: 768px) {
  .post-excerpt,
  .post-excerpt.image-left,
  .post-excerpt.image-right {
    flex-direction: column !important;
    gap: 1rem;
  }
  
  .post-image {
    flex: none;
    align-self: stretch;
    width: 100%;
  }
  
  .post-image-container {
    width: 100% !important;
    height: 200px !important;
    max-width: none !important;
  }
  
  .post-image-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .post-excerpt-text {
    max-height: 90px;
    -webkit-line-clamp: 3;
    line-clamp: 3;
    font-size: 14px;
  }
  
  .read_more {
    align-self: flex-end !important;
  }
}

/* 超小屏幕优化 */
@media (max-width: 480px) {
  .post-image-container {
    height: 160px !important;
  }
  
  .post-excerpt {
    gap: 0.8rem !important;
  }
}

/* 移动端图片显示强化 - 确保图片在所有移动设备上正确显示 */
@media (max-width: 768px) {
  /* 针对可能的图片显示问题的额外修复 */
  .post-image a {
    display: block !important;
    width: 100% !important;
  }
  
  /* 确保背景图片样式正确应用 */
  .post-image-container[style*="background-image"] {
    background-attachment: scroll !important; /* 移动端使用scroll而不是fixed */
    -webkit-background-size: cover !important;
    -moz-background-size: cover !important;
    -o-background-size: cover !important;
    background-size: cover !important;
  }
  
  /* 移动端图片容器的备用样式 */
  .post-image-container {
    border: 2px solid var(--kawaii-bg-secondary) !important; /* 添加边框以便调试 */
    background-color: var(--kawaii-bg-light) !important; /* 添加背景色以便查看容器 */
  }
}

/* 超小屏幕优化 */
@media (max-width: 480px) {
  .post-image-container {
    height: 160px !important; /* 超小屏幕稍微降低高度 */
  }
  
  .post-excerpt {
    gap: 0.8rem !important;
  }
}

/* -----------------------------------------------------------------------------
 * 页面初始状态优化 - 防止布局闪烁
 * -----------------------------------------------------------------------------
 */

html {
  scroll-behavior: smooth;
}

body {
  /* 防止页面跳跃 */
  overflow-x: hidden;
}

/* 确保关键内容在加载时有基础样式 */
.site-header {
  min-height: 60px;
  background-color: var(--kawaii-header-footer-bg);
}

.page-banner {
  min-height: 400px;
  background-color: var(--kawaii-bg-primary);
}

.main {
  min-height: 200px;
}

/* 改进的主题切换动画 - 排除page-banner以保持原始动画 */
html[data-theme="dark"] *:not(.page-banner):not(.page-banner *),
html[data-theme="light"] *:not(.page-banner):not(.page-banner *) {
  transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
}

/* 图片加载优化 */
img {
  opacity: 0;
  transition: opacity 0.3s ease;
}

img.loaded,
img[src$=".svg"] {
  opacity: 1;
}

/* 防止图片加载时的布局跳跃 */
.post-image-container {
  background-color: var(--kawaii-bg-light);
  display: flex;
  align-items: center;
  justify-content: center;
}

.post-image-container::before {
  content: '';
  display: block;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, 
    var(--kawaii-bg-light) 0%, 
    var(--kawaii-bg-secondary) 100%);
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0.3;
}

/* 字体加载优化 */
.site-title,
.page-banner-heading,
.page-banner-subheading {
  font-display: swap;
}

/* 内容区域最小高度，防止页面高度跳跃 */
.wrapper {
  min-height: 0; /* 改为0，让内容自然决定高度 */
}

/* 优化CSS Grid/Flexbox的加载性能 */
.post-excerpt {
  contain: layout;
}

/* 为慢速网络优化 */
@media (prefers-reduced-motion: reduce) {
  html {
    scroll-behavior: auto;
  }
}

/* 打印样式优化 */
@media print {
  .page-loading,
  .loading-animation {
    display: none !important;
  }
}

/* 确保页脚不会被异常拉伸 */
.site-footer {
  flex-shrink: 0; /* 防止页脚被压缩 */
}

/* 确保主要内容区域不会被异常拉伸 */
.page-content {
  flex: 1 0 auto; /* 让内容区域自动扩展，但不缩小 */
}

/* -----------------------------------------------------------------------------
 * 语言选择器和翻译菜单修复
 * -----------------------------------------------------------------------------
 */

/* 确保语言选择器正常显示 */
a.lang-select,
li a[class="lang-select"],
span.lang-select {
  display: inline-block !important;
  opacity: 1 !important;
  visibility: visible !important;
  position: relative;
  z-index: 10000 !important;
}

/* 确保国旗图片正常显示 */
.site-nav ul li img,
a.lang-select img,
li a[class="lang-select"] img {
  display: inline-block !important;
  max-width: 24px;
  height: auto;
  vertical-align: middle;
  margin-right: 5px;
  opacity: 1 !important;
}

/* 修复语言菜单的下拉显示 */
ul li:hover > ul,
ul li ul:hover {
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
  z-index: 10001 !important; 
}

/* 修复下拉菜单位置和显示 */
.site-nav ul li ul {
  position: absolute !important;
  background: var(--kawaii-header-footer-bg) !important;
  min-width: 150px;
  border: 1px solid var(--kawaii-bg-secondary);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

/* 确保当前语言和标志图标显示正确 */
[data-lang="en"], [data-lang="fr"], [data-lang="zh"] {
  display: inline-flex !important;
  align-items: center;
  z-index: 10000;
}

